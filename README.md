Профессиональный Telegram-бот для автоматизации сбора заявок от клиентов с сохранением данных в Google Sheets. Подходит малому бизнесу, фрилансерам и стартапам для быстрого запуска системы сбора лидов без затрат на сложные CRM.

Основные возможности
 Интерактивный интерфейс с кнопками и пошаговой формой
 Валидация данных (имя, телефон, сообщение)
 Подтверждение заявки перед отправкой
 Сохранение заявок в таблицу Google Sheets
 Уведомления администраторам в Telegram
 Админ-панель с командами и статистикой
 Защита от спама (ограничение на количество заявок)
 Полная система логирования событий
 Graceful shutdown при остановке
 Поддержка нескольких администраторов
 Deep linking для отслеживания источников
 Полный набор автоматических тестов

Технологии
Python 3.10+
aiogram 3.x (FSM, Callbacks, Middleware)
Google Sheets API (gspread, google-auth)
dotenv для управления конфигурацией
pytest для тестирования
logging с ротацией логов

Архитектура проекта
telegram-lead-bot/
├── bot/                    # Основной модуль бота
│   ├── handlers/           # Обработчики команд и сообщений
│   ├── states/             # Машина состояний (FSM)
│   ├── keyboards/          # Клавиатуры и кнопки
│   ├── middleware/         # Промежуточное ПО
│   ├── utils/              # Вспомогательные утилиты
│   ├── config.py           # Конфигурация из .env
│   └── bot.py              # Регистрация хендлеров
├── data/                   # Работа с данными (Google Sheets)
├── logs/                   # Логи работы бота
├── tests/                  # Автоматические тесты
├── main.py                 # Точка входа
├── .env                    # Переменные окружения
├── .gitignore              # Игнорируемые файлы
├── requirements.txt        # Зависимости
├── README.md               # Эта документация
├── Procfile                # Для деплоя (Render)
└── pytest.ini             # Конфигурация тестов

Установка и запуск
1. Клонирование репозитория
git clone https://github.com/NecroVIZ/telegram-lead-bot.git
cd telegram-lead-bot
2. Создание виртуального окружения
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate     # Windows
3. Установка зависимостей
pip install -r requirements.txt
4. Создание Telegram-бота
Найдите @BotFather в Telegram
Отправьте /newbot и следуйте инструкциям
Скопируйте полученный токен
5. Настройка Google Sheets API
Перейдите в Google Cloud Console
Создайте новый проект или выберите существующий
Включите Google Sheets API и Google Drive API
Создайте сервисный аккаунт:
IAM & Admin → Service Accounts → Create Service Account
Дайте ему роль Editor
Создайте JSON-ключ для сервисного аккаунта
Переименуйте ключ в creds.json и положите в корень проекта
Создайте таблицу Google Sheets
Дайте доступ к таблице сервисному аккаунту (email из JSON-ключа)
6. Конфигурация
Создайте файл .env в корне проекта:
# Токен Telegram-бота (обязательно)
BOT_TOKEN=ваш_токен_бота

# ID администраторов (через запятую, обязательно)
ADMIN_IDS=123456789,987654321

# Путь к JSON-ключу Google (опционально, по умолчанию creds.json)
GOOGLE_CREDS_PATH=creds.json

7. Запуск бота
python main.py

 Тестирование
Для запуска автоматических тестов:
# Запустить все тесты
pytest

# Запустить с подробным выводом
pytest -v

# Запустить тесты без предупреждений
pytest -v --disable-warnings

Команды бота
/start
Начать работу с ботом
/cancel
Отменить текущую форму
/help
Показать справку
/admin
Админ-панель (только для админов)
/stats
Статистика по заявкам (только для админов)

Безопасность
Все чувствительные данные (токены, ключи) хранятся в .env
Файл .env добавлен в .gitignore
Ограничение на количество заявок (3 в час) для защиты от спама
Валидация всех входных данных
Логирование без персональных данных
Проверка безопасности callback'ов

Масштабирование
Бот готов к работе в продакшене и может быть:

Задеплоен на облачные платформы (Render, Heroku, VPS)
Расширен функционал (оплата, календарь, CRM-интеграции)
Использован как основа для SaaS-продукта

Лицензия
MIT License - вы можете использовать этот код в своих проектах с указанием авторства.

Поддержка
Если у вас возникли вопросы или проблемы, создайте issue в репозитории GitHub.